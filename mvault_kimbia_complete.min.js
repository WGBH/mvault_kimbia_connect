function winHasJSON(t){var e;try{e=JSON.stringify(t)}catch(r){Rollbar.error("winHasJSON failed: ",r)}return e}function displayOverlay(){document.body.scrollTop=document.documentElement.scrollTop=0,jQuery("body").append('<div id="mvaultModal"></div>'),jQuery("#mvaultModal").css({background:MSB.styleOptions.modalBackground+" url(https://msb-static.wgbh.org/msb/loading.svg) no-repeat 49% 49%",position:"fixed",left:"0",top:"0",width:"100%",height:"100%",zIndex:1e4}),document.body.scrollTop=document.documentElement.scrollTop=0}function showFinalModal(t,e,r,o){jQuery("#mvaultModal").css({backgroundImage:"none"}),jQuery("#mvaultModal").append('<div id="mvaultResponse"></div>');var n="<div id='membershipVaultRtProvResp' class='mVRtPR'>";if(n+="  <div style='font-size: 3em; color: "+MSB.styleOptions.stationFontColor+";'>",n+="    <img src='https://msb-static.wgbh.org/msb/passport_compass_rose.svg' style='height:1em; vertical-align: text-middle' />",n+="    <span style='display: inline-block; margin-left: 0.25em;font-family: "+MSB.styleOptions.stationFont+"; font-weight: "+MSB.styleOptions.stationFontWeight+"'>"+MSB.stationId+"</span>",n+="    | Passport</div>",n+="  <h3> "+t+" </h3>",n+="  <p> "+e+" </p>",n+="  <a class='button button-activate' href='"+o+"' target='_blank' style='display: inline-block; padding: 6px 9px; background-color: #00aaeb; color: white; border-radius: 5px; text-transform: uppercase; font-weight: bold; text-decoration: none;' >"+r+"</a>",n+="</div>",jQuery("#mvaultResponse").html(n),void 0!==o){var a=o.match(/(\w+-\w+-\w+-\w+)$/);a&&jQuery("#membershipVaultRtProvResp").append("<p>OR activate later by entering your activation code: <br /><strong>"+a[0]+"</strong><br />at <em>pbs.org/passport</em></p>")}jQuery("#mvaultResponse").css({color:MSB.styleOptions.textFontColor,backgroundColor:MSB.styleOptions.panelBackgroundColor,width:"40%",minWidth:"300px",margin:"60px auto",lineHeight:"1.6",borderRadius:"0.5em",padding:"15px",boxShadow:"3px 3px 3px rgba(160, 160, 160, 0.5)"})}function sendObj(t){displayOverlay();var e=MSB.stationId,r=MSB.data[e].salesForceUrl,o="TEST"==e?{}:t;jQuery.ajax({url:r,data:o,method:"GET"}).done(function(t){var e=JSON.parse(t);return"undefined"===e.provisioning?(Rollbar.error("Provisioning failed: ",t),showFinalModal("Communications problem with server",MSB.data[MSB.stationId].phoneSupport,"Online Support",MSB.helpUrl),!1):void showFinalModal(e.ctaHeader,e.ctaMsg,e.ctaLabel,e.nextUrl)}).fail(function(t){Rollbar.error("Total failure: ",t),showFinalModal("No response from  server",MSB.data[MSB.stationId].phoneSupport,"Online Support",MSB.helpUrl)})}function getKimbiaEmail(t){for(var e="",r=0;r<t.answers[0].length;r++)if(t.answers[0][r].questionName.match(/email/i)){e=t.answers[0][r].data;break}return e}function kimbiaOnComplete(t){mVaultConnect(t)}if("undefined"==typeof jQuery){var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(s)}var _rollbarConfig={accessToken:"b21be8f1b37d41d8a80cc2be662832ec",captureUncaught:!0,payload:{environment:"test"}};!function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";var o=r(1).Rollbar,n=r(2);_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||"https://d37gvrvc0wt4s1.cloudfront.net/js/v1.8/rollbar.min.js";var a=o.init(window,_rollbarConfig),i=n(a,_rollbarConfig);a.loadFull(window,document,!_rollbarConfig.async,_rollbarConfig,i)},function(t){"use strict";function e(t){return function(){try{return t.apply(this,arguments)}catch(e){try{console.error("[Rollbar]: Internal error",e)}catch(r){}}}}function r(t,e,r){window._rollbarWrappedError&&(r[4]||(r[4]=window._rollbarWrappedError),r[5]||(r[5]=window._rollbarWrappedError._rollbarContext),window._rollbarWrappedError=null),t.uncaughtError.apply(t,r),e&&e.apply(window,r)}function o(t){var e=function(){var e=Array.prototype.slice.call(arguments,0);r(t,t._rollbarOldOnError,e)};return e.belongsToShim=!0,e}function n(t){this.shimId=++s,this.notifier=null,this.parentShim=t,this._rollbarOldOnError=null}function a(t){var r=n;return e(function(){if(this.notifier)return this.notifier[t].apply(this.notifier,arguments);var e=this,o="scope"===t;o&&(e=new r(this));var n=Array.prototype.slice.call(arguments,0),a={shim:e,method:t,args:n,ts:new Date};return window._rollbarShimQueue.push(a),o?e:void 0})}function i(t,e){if(e.hasOwnProperty&&e.hasOwnProperty("addEventListener")){var r=e.addEventListener;e.addEventListener=function(e,o,n){r.call(this,e,t.wrap(o),n)};var o=e.removeEventListener;e.removeEventListener=function(t,e,r){o.call(this,t,e&&e._wrapped?e._wrapped:e,r)}}}var s=0;n.init=function(t,r){var a=r.globalAlias||"Rollbar";if("object"==typeof t[a])return t[a];t._rollbarShimQueue=[],t._rollbarWrappedError=null,r=r||{};var s=new n;return e(function(){if(s.configure(r),r.captureUncaught){s._rollbarOldOnError=t.onerror,t.onerror=o(s);var e,n,l="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(e=0;e<l.length;++e)n=l[e],t[n]&&t[n].prototype&&i(s,t[n].prototype)}return t[a]=s,s})()},n.prototype.loadFull=function(t,r,o,n,a){var i=function(){var e;if(void 0===t._rollbarPayloadQueue){var r,o,n,i;for(e=Error("rollbar.js did not load");r=t._rollbarShimQueue.shift();)for(n=r.args,i=0;i<n.length;++i)if(o=n[i],"function"==typeof o){o(e);break}}"function"==typeof a&&a(e)},s=!1,l=r.createElement("script"),p=r.getElementsByTagName("script")[0],c=p.parentNode;l.crossOrigin="",l.src=n.rollbarJsUrl,l.async=!o,l.onload=l.onreadystatechange=e(function(){if(!(s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)){l.onload=l.onreadystatechange=null;try{c.removeChild(l)}catch(t){}s=!0,i()}}),c.insertBefore(l,p)},n.prototype.wrap=function(t,e){try{var r;if(r="function"==typeof e?e:function(){return e||{}},"function"!=typeof t)return t;if(t._isWrap)return t;if(!t._wrapped){t._wrapped=function(){try{return t.apply(this,arguments)}catch(e){throw e._rollbarContext=r()||{},e._rollbarContext._wrappedSource=""+t,window._rollbarWrappedError=e,e}},t._wrapped._isWrap=!0;for(var o in t)t.hasOwnProperty(o)&&(t._wrapped[o]=t[o])}return t._wrapped}catch(n){return t}};for(var l="log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError".split(","),p=0;p<l.length;++p)n.prototype[l[p]]=a(l[p]);t.exports={Rollbar:n,_rollbarWindowOnError:r}},function(t){"use strict";t.exports=function(t,e){return function(r){if(!r&&!window._rollbarInitialized){var o=window.RollbarNotifier,n=e||{},a=n.globalAlias||"Rollbar",i=window.Rollbar.init(n,t);i._processShimQueue(window._rollbarShimQueue||[]),window[a]=i,window._rollbarInitialized=!0,o.processPayloads()}}}}]);var MSB=MSB||function(){var t="Sorry, there was a problem creating your account. <br />Please contact PBS support toll free at ";return theObject=this,this.stationId="",{init:function(t,e){this.stationId=t,this.styleOptions={},this.styleOptions.theme="object"!=typeof e||["light","dark"].indexOf(e.theme)<0?"light":e.theme,this.setTheme(),"object"==typeof e&&jQuery.extend(this.styleOptions,e)},salesForceURL:function(){return this.data[this.stationId].salesForceUrl},data:{WGBH:{salesForceUrl:"https://mywgbh.secure.force.com/passport/services/apexrest/mvcms/v2.0/provision/a4531000000RzijAAC",phoneSupport:t+"844-421-3579"},NHPTV:{salesForceUrl:"https://mywgbh.secure.force.com/passport/services/apexrest/mvcms/v2.0/provision/a4531000000RzioAAC",phoneSupport:t+"844-326-6219"},WGBY:{salesForceUrl:"https://mywgbh.secure.force.com/passport/services/apexrest/mvcms/v2.0/provision/a4531000000RzitAAC",phoneSupport:t+"855-329-4292"}},setTheme:function(){this.styleOptions.stationFont="Helvetica, Arial, sans-serif",this.styleOptions.stationFontWeight="bold",this.styleOptions.textFont="Helvetica, Arial, sans-serif",this.styleOptions.modalZIndex=1e4,"light"===this.styleOptions.theme?(this.styleOptions.stationFontColor="#000000",this.styleOptions.textFontColor="#000000",this.styleOptions.panelBackgroundColor="#ffffff",this.styleOptions.modalBackground="rgba(0,0,0,0.8)"):"dark"===this.styleOptions.theme&&(this.styleOptions.stationFontColor="#eeeeee",this.styleOptions.textFontColor="#eeeeee",this.styleOptions.panelBackgroundColor="#333333",this.styleOptions.modalBackground="rgba(255,255,255,0.8)")},errorMsg:{phone:function(){},helpUrl:"http://help.pbs.org/"}}}(),mVaultConnect=function(t){if("undefined"!==winHasJSON(t)){var e={};e.email=getKimbiaEmail(t),""==e.email&&Rollbar.error("No email found in the donation form."),e.confirmationCode=t.confirmationCode;try{sendObj(e)}catch(r){Rollbar.error("KIMBIAComplete failed: ",r)}}try{"undefined"!=typeof ga&&ga("send",{hitType:"event",eventCategory:"support",eventAction:"donate",eventLabel:"with passport, using overlay"})}catch(r){Rollbar.error("ga Event failed: ",r)}};