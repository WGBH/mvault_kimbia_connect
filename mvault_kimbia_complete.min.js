function winHasJSON(a){var b;try{b=JSON.stringify(a)}catch(c){Rollbar.error("winHasJSON failed: ",c)}return b}function displayOverlay(){document.body.scrollTop=document.documentElement.scrollTop=0,jQuery("body").append('<div id="mvaultModal"></div>'),jQuery("#mvaultModal").css({background:MSB.styleOptions.modalBackground+" url(https://msb-static.wgbh.org/msb/loading.svg) no-repeat 49% 49%",position:"fixed",left:"0",top:"0",width:"100%",height:"100%",zIndex:1e4,textAlign:"center"}),document.body.scrollTop=document.documentElement.scrollTop=0}function showFinalModal(a,b,c,d){jQuery("#mvaultModal").css({backgroundImage:"none"}),jQuery("#mvaultModal").append('<div id="mvaultResponse"></div>');var e="<div id='membershipVaultRtProvResp' class='mVRtPR'>";if(e+="  <div style='font-size: 3em; color: "+MSB.styleOptions.stationFontColor+";'>",e+="    <img src='https://msb-static.wgbh.org/msb/passport_compass_rose.svg' style='height:1em; vertical-align: text-middle' />",e+="    <span style='display: inline-block; margin-left: 0.25em;font-family: "+MSB.styleOptions.stationFont+"; font-weight: "+MSB.styleOptions.stationFontWeight+"'>"+MSB.stationId+"</span>",e+="    | Passport</div>",e+="  <h3> "+a+" </h3>",e+="  <p> "+b+" </p>",e+="  <a class='button button-activate' href='"+d+"' target='_blank' style='display: inline-block; padding: 6px 9px; background-color: #00aaeb; color: white; border-radius: 5px; text-transform: uppercase; font-weight: bold; text-decoration: none;' >"+c+"</a>",e+="</div>",jQuery("#mvaultResponse").html(e),"undefined"!=typeof d){var f=d.match(/(\w+-\w+-\w+-\w+)$/);f&&jQuery("#membershipVaultRtProvResp").append("<p>OR activate later by entering your activation code: <br /><strong>"+f[0]+"</strong><br />at <em>pbs.org/passport</em></p>")}jQuery("#mvaultResponse").css({color:MSB.styleOptions.textFontColor,backgroundColor:MSB.styleOptions.panelBackgroundColor,width:"40%",minWidth:"300px",margin:"60px auto",lineHeight:"1.6",borderRadius:"0.5em",padding:"15px",boxShadow:"3px 3px 3px rgba(160, 160, 160, 0.5)"})}function sendObj(a){displayOverlay();var b=MSB.stationId,c=MSB.data[b].salesForceUrl,d="TEST"==b?{}:a;jQuery.ajax({url:c,data:d,method:"GET"}).done(function(a){var b=JSON.parse(a);return"undefined"===b.provisioning?(Rollbar.error("Provisioning failed: ",a),showFinalModal("Communications problem with server",MSB.data[MSB.stationId].phoneSupport,"Online Support",MSB.helpUrl),!1):void showFinalModal(b.ctaHeader,b.ctaMsg,b.ctaLabel,b.nextUrl)}).fail(function(a){Rollbar.error("Total failure: ",a),showFinalModal("No response from  server",MSB.data[MSB.stationId].phoneSupport,"Online Support",MSB.helpUrl)})}function getKimbiaEmail(a){for(var b="",c=0;c<a.answers[0].length;c++)if(a.answers[0][c].questionName.match(/email/i)){b=a.answers[0][c].data;break}return b}function kimbiaOnComplete(a){mVaultConnect(a)}if("undefined"==typeof jQuery){var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(s)}var _rollbarConfig={accessToken:"b21be8f1b37d41d8a80cc2be662832ec",captureUncaught:!0,payload:{environment:"test"}};!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";var d=c(1).Rollbar,e=c(2);_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||"https://d37gvrvc0wt4s1.cloudfront.net/js/v1.8/rollbar.min.js";var f=d.init(window,_rollbarConfig),g=e(f,_rollbarConfig);f.loadFull(window,document,!_rollbarConfig.async,_rollbarConfig,g)},function(a,b){"use strict";function c(a){return function(){try{return a.apply(this,arguments)}catch(b){try{console.error("[Rollbar]: Internal error",b)}catch(c){}}}}function d(a,b,c){window._rollbarWrappedError&&(c[4]||(c[4]=window._rollbarWrappedError),c[5]||(c[5]=window._rollbarWrappedError._rollbarContext),window._rollbarWrappedError=null),a.uncaughtError.apply(a,c),b&&b.apply(window,c)}function e(a){var b=function(){var b=Array.prototype.slice.call(arguments,0);d(a,a._rollbarOldOnError,b)};return b.belongsToShim=!0,b}function f(a){this.shimId=++i,this.notifier=null,this.parentShim=a,this._rollbarOldOnError=null}function g(a){var b=f;return c(function(){if(this.notifier)return this.notifier[a].apply(this.notifier,arguments);var c=this,d="scope"===a;d&&(c=new b(this));var e=Array.prototype.slice.call(arguments,0),f={shim:c,method:a,args:e,ts:new Date};return window._rollbarShimQueue.push(f),d?c:void 0})}function h(a,b){if(b.hasOwnProperty&&b.hasOwnProperty("addEventListener")){var c=b.addEventListener;b.addEventListener=function(b,d,e){c.call(this,b,a.wrap(d),e)};var d=b.removeEventListener;b.removeEventListener=function(a,b,c){d.call(this,a,b&&b._wrapped?b._wrapped:b,c)}}}var i=0;f.init=function(a,b){var d=b.globalAlias||"Rollbar";if("object"==typeof a[d])return a[d];a._rollbarShimQueue=[],a._rollbarWrappedError=null,b=b||{};var g=new f;return c(function(){if(g.configure(b),b.captureUncaught){g._rollbarOldOnError=a.onerror,a.onerror=e(g);var c,f,i="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(c=0;c<i.length;++c)f=i[c],a[f]&&a[f].prototype&&h(g,a[f].prototype)}return a[d]=g,g})()},f.prototype.loadFull=function(a,b,d,e,f){var g=function(){var b;if(void 0===a._rollbarPayloadQueue){var c,d,e,g;for(b=new Error("rollbar.js did not load");c=a._rollbarShimQueue.shift();)for(e=c.args,g=0;g<e.length;++g)if(d=e[g],"function"==typeof d){d(b);break}}"function"==typeof f&&f(b)},h=!1,i=b.createElement("script"),j=b.getElementsByTagName("script")[0],k=j.parentNode;i.crossOrigin="",i.src=e.rollbarJsUrl,i.async=!d,i.onload=i.onreadystatechange=c(function(){if(!(h||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)){i.onload=i.onreadystatechange=null;try{k.removeChild(i)}catch(a){}h=!0,g()}}),k.insertBefore(i,j)},f.prototype.wrap=function(a,b){try{var c;if(c="function"==typeof b?b:function(){return b||{}},"function"!=typeof a)return a;if(a._isWrap)return a;if(!a._wrapped){a._wrapped=function(){try{return a.apply(this,arguments)}catch(b){throw b._rollbarContext=c()||{},b._rollbarContext._wrappedSource=a.toString(),window._rollbarWrappedError=b,b}},a._wrapped._isWrap=!0;for(var d in a)a.hasOwnProperty(d)&&(a._wrapped[d]=a[d])}return a._wrapped}catch(e){return a}};for(var j="log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError".split(","),k=0;k<j.length;++k)f.prototype[j[k]]=g(j[k]);a.exports={Rollbar:f,_rollbarWindowOnError:d}},function(a,b){"use strict";a.exports=function(a,b){return function(c){if(!c&&!window._rollbarInitialized){var d=window.RollbarNotifier,e=b||{},f=e.globalAlias||"Rollbar",g=window.Rollbar.init(e,a);g._processShimQueue(window._rollbarShimQueue||[]),window[f]=g,window._rollbarInitialized=!0,d.processPayloads()}}}}]);var MSB=MSB||function(){var a="Sorry, there was a problem creating your account. <br />Please contact PBS support toll free at ";return theObject=this,this.stationId="",{init:function(a,b){this.stationId=a,this.styleOptions={},"object"!=typeof b||["light","dark"].indexOf(b.theme)<0?this.styleOptions.theme="light":this.styleOptions.theme=b.theme,this.setTheme(),"object"==typeof b&&jQuery.extend(this.styleOptions,b)},salesForceURL:function(a){return this.data[this.stationId].salesForceUrl},data:{WGBH:{salesForceUrl:"https://mywgbh.secure.force.com/passport/services/apexrest/mvcms/v2.0/provision/a4531000000RzijAAC",phoneSupport:a+"844-421-3579"},NHPTV:{salesForceUrl:"https://mywgbh.secure.force.com/passport/services/apexrest/mvcms/v2.0/provision/a4531000000RzioAAC",phoneSupport:a+"844-326-6219"},WGBY:{salesForceUrl:"https://mywgbh.secure.force.com/passport/services/apexrest/mvcms/v2.0/provision/a4531000000RzitAAC",phoneSupport:a+"855-329-4292"}},setTheme:function(){this.styleOptions.stationFont="Helvetica, Arial, sans-serif",this.styleOptions.stationFontWeight="bold",this.styleOptions.textFont="Helvetica, Arial, sans-serif",this.styleOptions.modalZIndex=1e4,"light"===this.styleOptions.theme?(this.styleOptions.stationFontColor="#000000",this.styleOptions.textFontColor="#000000",this.styleOptions.panelBackgroundColor="#ffffff",this.styleOptions.modalBackground="rgba(0,0,0,0.8)"):"dark"===this.styleOptions.theme&&(this.styleOptions.stationFontColor="#eeeeee",this.styleOptions.textFontColor="#eeeeee",this.styleOptions.panelBackgroundColor="#333333",this.styleOptions.modalBackground="rgba(255,255,255,0.8)")},errorMsg:{phone:function(){},helpUrl:"http://help.pbs.org/"}}}(),mVaultConnect=function(a){if("undefined"!==winHasJSON(a)){var b={};b.email=getKimbiaEmail(a),""==b.email&&Rollbar.error("No email found in the donation form."),b.confirmationCode=a.confirmationCode;try{sendObj(b)}catch(c){Rollbar.error("KIMBIAComplete failed: ",c)}}try{"undefined"!=typeof ga&&ga("send",{hitType:"event",eventCategory:"support",eventAction:"donate",eventLabel:"with passport, using overlay"})}catch(c){Rollbar.error("ga Event failed: ",c)}};